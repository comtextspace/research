import{_ as i,c,b as l,a as s,d as e,w as t,r as o,o as r,e as p}from"./app-3vC-laG6.js";const d={},u={class:"table-of-contents"};function m(v,n){const a=o("router-link");return r(),c("div",null,[n[6]||(n[6]=l(`<h1 id="проблемы-конвертации-маркдаун-в-фб2-через-пандок" tabindex="-1"><a class="header-anchor" href="#проблемы-конвертации-маркдаун-в-фб2-через-пандок"><span>Проблемы конвертации Маркдаун в ФБ2 через Пандок</span></a></h1><p><strong>22.02.2026</strong></p><p>Форматы Маркдаун и ФБ2 предлагают схожие возможности для разметки текста, однако между ними есть различия, которые усложняют конвертацию. Ниже описаны проблемные случаи, возникающие при преобразовании из Маркдауна в ФБ2 с помощью <a href="https://pandoc.org" target="_blank" rel="noopener noreferrer">Пандок</a>.</p><p>Схема валидации ФБ2 зафиксирована <a href="https://github.com/gribuser/fb2" target="_blank" rel="noopener noreferrer">в репозитории Дмитрия Гибова</a>. Дополнительные комментарии к спецификации формата доступны на <a href="http://www.fictionbook.org/index.php/%D0%9E%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5_%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B0_FB2_%D0%BE%D1%82_Sclex" target="_blank" rel="noopener noreferrer">fictionbook.org</a>.</p><p>Возможно, эта информация может помочь <a href="https://github.com/jgm/pandoc" target="_blank" rel="noopener noreferrer">доработать Пандок</a>. Также часть проблем, возможно, удастся обойти с помощью настроек Пандока или пользовательских шаблонов для ФБ2.</p><p>Версия, на которой проводились эксперименты:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token variable">$pandoc</span> <span class="token parameter variable">-v</span></span>
<span class="line">pandoc <span class="token number">3.7</span>.0.1</span>
<span class="line">Features: +server +lua</span>
<span class="line">Scripting engine: Lua <span class="token number">5.4</span></span>
<span class="line">User data directory: /home/petro/.local/share/pandoc</span>
<span class="line">Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2006</span>-2024 John MacFarlane. Web: https://pandoc.org</span>
<span class="line">This is <span class="token function">free</span> software<span class="token punctuation">;</span> see the <span class="token builtin class-name">source</span> <span class="token keyword">for</span> copying conditions. There is no</span>
<span class="line">warranty, not even <span class="token keyword">for</span> merchantability or fitness <span class="token keyword">for</span> a particular purpose.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="оглавление" tabindex="-1"><a class="header-anchor" href="#оглавление"><span>Оглавление</span></a></h2>`,8)),s("nav",u,[s("ul",null,[s("li",null,[e(a,{to:"#оглавление"},{default:t(()=>n[0]||(n[0]=[p("Оглавление")])),_:1})]),s("li",null,[e(a,{to:"#метаданные"},{default:t(()=>n[1]||(n[1]=[p("Метаданные")])),_:1})]),s("li",null,[e(a,{to:"#genre"},{default:t(()=>n[2]||(n[2]=[p("genre")])),_:1})]),s("li",null,[e(a,{to:"#code"},{default:t(()=>n[3]||(n[3]=[p("code")])),_:1})]),s("li",null,[e(a,{to:"#section"},{default:t(()=>n[4]||(n[4]=[p("section")])),_:1})]),s("li",null,[e(a,{to:"#заключение"},{default:t(()=>n[5]||(n[5]=[p("Заключение")])),_:1})])])]),n[7]||(n[7]=l(`<h2 id="метаданные" tabindex="-1"><a class="header-anchor" href="#метаданные"><span>Метаданные</span></a></h2><p>В Пандок нет простого способа заполнить следующие поля ФБ2:</p><ul><li><code>document-info</code> — <code>author</code></li><li><code>document-info</code> — <code>date</code></li><li><code>document-info</code> — <code>id</code></li><li><code>document-info</code> — <code>version</code></li></ul><p>Также отсутствует возможность добавить дополнительную информацию через элементы <code>custom-info</code>.</p><h2 id="genre" tabindex="-1"><a class="header-anchor" href="#genre"><span>genre</span></a></h2><p>Указание жанра в ФБ2 обязательно. Если жанр не указан, Пандок генерирует заглушку:</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>genre</span><span class="token punctuation">&gt;</span></span>unrecognised<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>genre</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>При указании одного жанра генерация проходит корректно:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">title</span><span class="token punctuation">:</span> Метафизика</span>
<span class="line"><span class="token key atrule">author</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> Аристотель</span>
<span class="line"><span class="token key atrule">genre</span><span class="token punctuation">:</span> sci_history</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Результат:</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>genre</span><span class="token punctuation">&gt;</span></span>sci_history<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>genre</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Однако при попытке добавить несколько жанров Пандок снова возвращает заглушку, хотя должен создать два отдельных элемента <code>genre</code>.</p><p>Пример входных данных:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">title</span><span class="token punctuation">:</span> Метафизика</span>
<span class="line"><span class="token key atrule">author</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">-</span> Аристотель</span>
<span class="line"><span class="token key atrule">genre</span><span class="token punctuation">:</span> sci_history</span>
<span class="line"><span class="token key atrule">genre</span><span class="token punctuation">:</span> sci_philosophy</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ожидаемый результат в ФБ2:</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>genre</span><span class="token punctuation">&gt;</span></span>sci_history<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>genre</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>genre</span><span class="token punctuation">&gt;</span></span>sci_philosophy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>genre</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Фактический результат — заглушка <code>unrecognised</code>.</p><h2 id="code" tabindex="-1"><a class="header-anchor" href="#code"><span>code</span></a></h2><p>В ФБ2 элемент <code>code</code> всегда должен находиться внутри тега <code>p</code>. Пандок ошибочно размещает блоки с формулами вне параграфа. Остальные случаи с формулами и блоками кода конвертируются верно.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">$$</span>
<span class="line">x = a + b</span>
<span class="line">$$</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Резульат в ФБ2:</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>x = a + b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Правильный вариант для ФБ2:</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>x = a + b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="section" tabindex="-1"><a class="header-anchor" href="#section"><span>section</span></a></h2><p>Структура ФБ2 строже, чем в Маркдаун.</p><p>Маркдаун позволяет создавать разделы без содержания, но при валидации ФБ2 это вызовет ошибку. Такая структура заголовков часто встречается в дневниках: есть дата или тема, но самого текста записи нет.</p><p>Пример:</p><div class="language-markdown line-numbers-mode" data-highlighter="prismjs" data-ext="md"><pre><code><span class="line"><span class="token title important"><span class="token punctuation">#</span> Мой дневник</span></span>
<span class="line"></span>
<span class="line"><span class="token title important"><span class="token punctuation">##</span> 2021</span></span>
<span class="line"></span>
<span class="line"><span class="token title important"><span class="token punctuation">###</span> 20 января — зоопарк</span></span>
<span class="line"></span>
<span class="line">Ходил в зоопарк.</span>
<span class="line"></span>
<span class="line"><span class="token title important"><span class="token punctuation">###</span> 23 января — заболел</span></span>
<span class="line"></span>
<span class="line"><span class="token title important"><span class="token punctuation">##</span> 2022</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>В этом случае для записи «23 января — заболел» Пандок сгенерирует секцию, содержащую только заголовок. Вероятно, решение заключается в автоматической генерации фиктивного параграфа.</p><p>Текущий вывод:</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>23 января — заболел<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Другая проблема связана с порядком элементов. В Маркдаун раздел может начинаться с текста, за которым следуют подразделы:</p><div class="language-markdown line-numbers-mode" data-highlighter="prismjs" data-ext="md"><pre><code><span class="line"><span class="token title important"><span class="token punctuation">#</span> Моя книга</span></span>
<span class="line"></span>
<span class="line">Это книга которую я написал.</span>
<span class="line"></span>
<span class="line"><span class="token title important"><span class="token punctuation">##</span> Глава 1</span></span>
<span class="line"></span>
<span class="line"><span class="token title important"><span class="token punctuation">##</span> Глава 2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Стандарт ФБ2 допускает внутри секции либо группу вложенных секций, либо контент (параграфы и изображения), но не их смесь в произвольном порядке. В примере выше секция «Моя книга» содержит сначала параграф, а затем две вложенные секции.</p><p>Предположительное решение: обернуть текст, идущий до первой вложенной секции, в фиктивную секцию без элемента <code>title</code>. В этом случае дополнительная секция не попадет в оглавление, а файл пройдет валидацию.</p><h2 id="заключение" tabindex="-1"><a class="header-anchor" href="#заключение"><span>Заключение</span></a></h2><p>Стоит отметить, что даже невалидные файлы ФБ2 обычно открываются в читалках. Кроме того, некоторые из описанных ограничений целесообразно убрать из схемы проверки формата. Однако пока приходится работать с существующими требованиями.</p>`,38))])}const g=i(d,[["render",m]]),b=JSON.parse('{"path":"/%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B-%D0%BA%D0%BE%D0%BD%D0%B2%D0%B5%D1%80%D1%82%D0%B0%D1%86%D0%B8%D0%B8-%D0%BC%D0%B0%D1%80%D0%BA%D0%B4%D0%B0%D1%83%D0%BD-%D0%B2-%D1%84%D0%B12-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-%D0%BF%D0%B0%D0%BD%D0%B4%D0%BE%D0%BA.html","title":"Проблемы конвертации Маркдаун в ФБ2 через Пандок","lang":"ru-RU","frontmatter":{},"git":{"updatedTime":1771769311000,"contributors":[{"name":"Petro","username":"Petro","email":"petrovdrm86@yandex.ru","commits":1,"url":"https://github.com/Petro"}],"changelog":[{"hash":"b2e433cc53ef173bee5602445e57c795afe1eeef","time":1771769311000,"email":"petrovdrm86@yandex.ru","author":"Petro","message":"Добавлена заметка про конвертацию из МД в ФБ2"}]},"filePathRelative":"проблемы-конвертации-маркдаун-в-фб2-через-пандок.md"}');export{g as comp,b as data};
