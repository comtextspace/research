
# Формат Comtext

ComText — формат хранения, обработки и передачи текстологических данных. ComText направлен на международное взаимодействия и облегчает обмен информацией. ComText обеспечивает преимущества при:

* переводах на разные языки, при переводах на несколько языков одного источника, сравнении разных переводов;
* сравнении разных изданий;
* работы с источниками в виде фотокопий;
* конвертации текстов в современные форматы воспринимаемые любыми электронными устройствами;
* поиске работ (статей, книг и других) и поиске внутри текстов;
* построении и оформлении списка литературы и библиографических ссылок;
* построении перекрёстных ссылок между текстами, формировании указателей имён и тем.

ComText не описывает реализацию программных систем, а только обеспечивает совместимость разрабатываемых на его основе стандарта систем — возможность обмена данными между системами. Программные системы реализующие ComText строятся на разных технологических стеках и могут иметь большую или меньшую степень соответствия стандарту в зависимости от нужд и возможностей момента и коллектива разработчиков. Стандарт содержит базовые рекомендации по реализации, но их следует воспринимать скорее как советы чем как прямые указания.

[[toc]]

## Версия

Версия формата следует принципам [семантического версионирования](https://semver.org/).

Текущая версия: 1.5.0.

Ссылки на другие версии смотрите в на странице [История изменений](/format-comtext-changelog).

## Кодировка

Все файлы должны быть в кодировке UTF-8.

Для символов окончания строк должен использоваться [LF](https://unicode-table.com/en/000A/).

## Метаинформация

В начале файла **допустимо** указать метаданные ([Frontmatter](https://www.seancdavis.com/posts/wtf-is-frontmatter/)). Метаданные указываются в формате [YAML](https://ru.wikipedia.org/wiki/YAML) и отделяются от основного текста тремя тире `---`.

```
---
format: comtext
version: 1.5.0
title: Название книги
author:
- Иван Петров
---
```

Далее описаны поля метаинформации.

### format

Обязательное. Обозначает формат и всегда содержит значение `comtext`.

### version

Обязательное. Обозначает версию формата.

### title

Не обязательное. Обозначает название книги.

### author

Не обязательное. Обозначает список авторов книги.

Имена могут быть указаны в трех форматах:

* `имя отчество фамилия`
* `имя фамилия`
* `фамилия или псевдоним`

Примеры:

```
---
author:
- Иван Васильевич Петров
- Иван Петров
- И. В. Петров
- И. Петров
- Петров
- Аристотель
---
```

## Описание разметки

Разметка, по большей части соответствует Markdown  с некоторыми дополнениями. Придерживайтесь описанного ниже синтаксиса, тогда книги будут правильно конвертированы во все форматы.

### Абзацы

Абзацы разделяются пустой строкой.

```md
Освобождение категорически представляет собой закон исключённого третьего. Искусство категорически раскладывает на элементы трансцендентальный гений, ломая рамки привычных представлений. Адаптация, по определению, естественно понимает под собой напряженный катарсис, хотя в официозе принято обратное. Предмет деятельности подрывает типичный закон исключённого третьего. Апостериори, атомистика естественно заполняет непредвиденный знак, хотя в официозе принято обратное. Антропосоциология индуцирует конфликт.

Сомнение, как следует из вышесказанного, индуцирует гедонизм. Катарсис преобразует дедуктивный метод. Любовь творит непредвиденный дуализм. Представляется логичным, что дедуктивный метод реально понимает под собой закон исключённого третьего, tertium nоn datur. По своим философским взглядам Дезами был материалистом и атеистом, последователем Гельвеция, однако галактика индуцирует дедуктивный метод. Позитивизм методологически принимает во внимание естественный позитивизм.

Ощущение мира индуктивно преобразует мир. Актуализация трансформирует данный гравитационный парадокс. Дедуктивный метод, как принято считать, неоднозначен. Знак раскладывает на элементы конфликт, учитывая опасность, которую представляли собой писания Дюринга для не окрепшего еще немецкого рабочего движения.
```

### Заголовки

Заголовки начинаются с символа решётки `#`. Количество символов определяет уровень заголовка.

```md
# Заголовок первого уровня

## Заголовок второго уровня

### Заголовок третьего уровня

#### Заголовок четвертого уровня

##### Заголовок пятого уровня

###### Заголовок шестого уровня
```

Требования:

* Заголовки книг начинаются со второго уровня. Заглавие книги формируется из поля `title`  метаданных;
* Заголовки должны идти без пропусков с соблюдением вложенности, за заголовком уровня `n` должен следовать заголовок уровня `n+1`;
* После последнего символа `#` должен находиться один пробел;
* Существует только 6 уровней заголовков;
* Заголовок не должен завершаться символами `:,.`.

### Курсив

Курсив выделяется одиночными звёздочками (`*`):

```md
Этот текст *написан курсивом*.
```

### Полужирный

Полужирный шрифт выделяется двойными звёздочками (`**`):

```md
Этот текст **написан полужирным шрифтом**.
```

### Полужирный и курсив одновременно

Курсив и полужирный шрифт одновременно выделяются тремя звездочками (`***`):

```md
Этот текст ***написан курсивом и полужирным шрифтом***.
```

### Разрядка

[Разрядка](https://ru.wikipedia.org/wiki/Разрядка_(типографика)) выделяется двумя символами подчеркивания (`__`):

```md
Этот текст __написан разрядкой__.
```

### Списки

Между символом маркировки списка и текстом всегда должен быть один пробел.

#### Маркированные списки

Маркированные списки оформляются звёздочкой и пробелом в начале строки.

```md
* Апельсины
* Лимоны
* Яблоки
```

#### Нумерованные списки

Нумерованные списки оформляются цифрой, точкой и пробелом в начале строки.

```md
1. Апельсины
1. Лимоны
1. Яблоки
```

Если абзац начинается с цифры и не является элементом списка, то используйте символ экранирования (`\`) перед точкой:

```md
1\. это начало абзаца, а не список
```

#### Вложенные списки

Списки могут быть вложенные, для каждого уровня маркированного списка добавляйте два пробела, а для нумерованного три:

```md
* Инструменты
  * Молоток
  * Отвёртка

1. Кружок M3
  1. Участник 1
  1. Участник 2
```

### Цитаты

Цитаты выделяются символом больше (`>`) и пробелом в начале строки. Пробел всегда должен быть один.

```md
> Люди всегда были и всегда будут глупенькими жертвами обмана и самообмана в политике, пока они не научатся за любыми нравственными, религиозными, политическими, социальными фразами, заявлениями, обещаниями разыскивать интересы тех или иных классов.
```

[Требование pandoc](https://pandoc.org/MANUAL.html#block-quotations): цитата должна быть в начале документа или перед цитатой должна находится пустая строка:

```md
Знаменитая цитата Ленина:

> Люди всегда были и всегда будут глупенькими жертвами обмана и самообмана в политике, пока они не научатся за любыми нравственными, религиозными, политическими, социальными фразами, заявлениями, обещаниями разыскивать интересы тех или иных классов.
```

Для деления цитат на абзацы добавляйте пустую строку с символом `>`:

```
> Первый абзац
>
> Второй абзац
```

Если цитата — это стихотворенье, то для того, чтобы строки отображались с межстрочным интервалом (а не межабзацным), используйте придельный перевод строки внутри абзаца. Для этого добавьте **в конце строки** пробел и слеш:

```md
Стихотворение:

> Ешь ананасы, \
> рябчиков жуй, \
> день твой последний \
> приходит, буржуй.
```

* [Описание абзацев в Pandoc](https://pandoc.org/MANUAL.html#paragraphs)

### Сноски (примечания)

Для оформления сносок используются квадратные скобки и крышечка (`^`):

```md
И дальше: «Надо создать в России изучение и преподавание системы Тейлора, систематическое испытание и приспособление ее»[^3]. Конечно, ударение в работе по увеличению продуктивности живого человеческого труда в условиях Советского государства мы должны делать на повышении квалификации труда и улучшении его качества путем применения добытых наукой и практикой приемов работ, экономящих затрату человеческой энергии.

[^3]: В. И. Ленин. Поли. собр. соч., т. 36, с. 180, 190.
```

**Рекомендация:** размещайте текст сноски после абзаца к которому она относится, за исключением случая когда на одну сноску несколько ссылок, в этом случае сноски можно разместить в конце книги.

Если сносок несколько, то разделяйте их пустой строкой.

```
[^1]: первая сноска.

[^2]: вторая сноска.
```

#### Виды сносок

Различаются два вида сносок

* Авторские (`Авт.`)
* Редакторские (`Ред.`)

Тип сноски указывается в конце текста сноски, для многострочных сносок в конце последнего абзаца:

```
[^1]: авторское примечание. Авт.

[^2]: редакторское примечание. Ред.
```

Регистр символов и форматирование не учитывается, следующие определения равнозначны

```
[^1]: авторское примечание. авт.

[^1]: авторское примечание. *Авт.*

[^1]: авторское примечание. **Авт.**
```

Если тип сноски не указан явно, то она считается редакторской.

#### Многострочные сноски

Иногда текст сноски содержит несколько абзацев. В этом случае второй и последующие абзацы сноски начните с четырёх пробелов. Между абзацами добавляйте пустую строку.

```md
Эта книга предлагает новую интерпретацию рождения, эволюции и смерти СССР. В значительной степени мы полагаемся на имеющуюся литературу. Однако «излишковая»[^2] теория класса, которую мы находим у Маркса и используем для анализа советской истории, резко отличается от теорий, используемых как ее защитниками, так и ее критиками.

[^2]: В оригинале «the «surplus» theory of class». По всей видимости, в англоязычной литературе помимо категорий «surplus value» (прибавочная стоимость), «surplus product» (прибавочный продукт), «surplus labour» (прибавочный труд) и т. д. имеется понятие «surplus», являющееся *родовым* по отношению к вышеупомянутым понятиям. Как мы видим, в русскоязычной марксистской литературе на сегодняшний день сложилась норма перевода прилагательного «surplus» как «прибавочный (-ая)» и в этом смысле понятие «the „surplus“ theory of class» стоило перевести как «„прибавочная“ теория класса».

    Однако, как читатель увидит далее, эта теория класса, развиваемая Резником и Вольфом, получила свое название из-за того, что она, в отличие от других теорий класса, во главу угла ставит «social organization of the surplus» — общественный способ того, как в том или ином обществе организованы производство и распределение результатов труда, которые остаются за вычетом того, что требуется для простого воспроизводства этого общества. Как мы видим, в данном контексте «surplus» используется как существительное.

    Поскольку Резник и Вольф говорят об этой категории в смысле общего как для капитализма, так и для коммунизма, то нами принято решение везде в тексте переводить «surplus», когда оно употребляется как существительное, как «излишек», когда оно употребляется как прилагательное в устойчивых выражениях (surplus value, surplus product, surplus labour etc.), — как «прибавочный (-ая)»; и наконец, когда оно употребляется как прилагательное в неологизмах (surplus theory of class), — как «излишковый».
```


### Библиография

Ссылки на библиографию оформляются похожим на сноски способом со следующими отличиями:

* Вместо символа `^` используется символ `@`;
* После символа `@` идет идентифкатор книги, он может состять букв, цифр и символа подчёркивания `_`. Идентифкатор книги не может начинаться с цифры;
* Кроме ссылки на идентифкатор книги в квадратных скобках может быть указана дополнительная информация, например, номера страниц или глав книги.

```
пределов поставленных развитию продуктивных сил человека капиталом [@marxCapitalVol1, с. 143] является
```

Такое представление ссылок на библиографию сходно с тем что [используется в Pandoc](https://pandoc.org/demo/example19/Extension-citations.html).

Библиографиеческий список рекомендовано размещать в конце книги, отличия от сносок только в использовании символа `@`:

```
[@marxCapitalVol1]: К. Маркс. Капитал, том 1.
```



### Горизонтальная линия

Для задания горизонтальной лини используйте три [дефис-минуса](https://unicode-table.com/ru/002D/), отделённые пустыми строками.

```md

---

```

### Формулы

#### Способы встраивания

Для встраивания формул используется LaTeX. Возможны два вида встраивания формулы: внутри строки и отдельным блоком. 

Для встраивания внутри строки используются символы `$`:

```md
Квадратное уровнение $x^2 + x + 3 = 2$ демонстрирует зависмость между...
```

Квадратное уравнение $x^2 + x + 3 = 2$ демонстрирует зависимость между...

Для встраивания формул отдельным блокам используйте два символа `$$`:

```md
$$
\frac{K+p'K}{K_1+p'K_1} = \frac{K(1+p')}{K_1(1+p')} = \frac{K}{K_1}
$$
```

$$
\frac{K+p'K}{K_1+p'K_1} = \frac{K(1+p')}{K_1(1+p')} = \frac{K}{K_1}
$$

#### Пробелы

Для добавления пробелов между словами в формулах используйте `\medspace`:

```
$$
\frac{стоимость \medspace продукта \medspace А}{стоимость \medspace продукта \medspace Б} = \frac{стоимость \medspace 4 \medspace часов \medspace труда}{стоимость \medspace 2 \medspace часов \medspace труда}
$$
```

$$
\frac{стоимость \medspace продукта \medspace А}{стоимость \medspace продукта \medspace Б} = \frac{стоимость \medspace 4 \medspace часов \medspace труда}{стоимость \medspace 2 \medspace часов \medspace труда}
$$

#### Информация по LaTeX

Более детальное описание LaTeX вы можете найти в любой книге, например в [этой](https://www.mccme.ru/free-books/llang/newllang.pdf).

### Блок кода

Для добавления блоков кода используйте три символа “```”.

````
```
  var a = 23;
```
````

### Изображения

Синтаксис добавления изображений:

```
![Заголовок_изображения](имя_файла_изображения)
```

Пример
```
![1. Схема товарного обращения по Кенэ](Рубин%20Исаак%20Ильич.%20История%20экономической%20мысли/kene-1.png)
```

Пробелы в названии файлов должны быть заменены на `%20`.

Описание способа размещения в [описании структуры файлов](structure.md).

### Номера страниц

Для указания номеров страниц используйте следующий синтаксис

```
[# page_number]
```

Например:

```
Первый применяется для взвешивания [# 23] особенно ценных товаров, как золото...
```

Страница может разрывать абзац или даже одно слово может начинаться на одной странице и переноситься на следующую. В случае разрыва слова, следует добавить номер страницы внутри него, без дополнительных пробелов:

```
Первый применяется для взвеши[# 23]вания особенно ценных товаров, как золото...
```

Если абзац заканчивается на границы страниц, то добавляйте номер страницы после текста абзаца:

```
Первый применяется для взвешивания ... таких как золото. [# 23]

Второй абзац
```

### Экранирование символов

Экранирование символов применяется когда нужно отобразить символ который используется для разметки, например, символ `*`. В обычной ситуации этот символ обозначает начала блока текста, выделенного курсивом. Чтобы просто отобразить этот символ перед ним нужно поставить символ обратного слеша `\`.

```
Следующий символ \* не является элементом разметки и отобразится как обычный символ.
То же самое с квардратными скобками \[# 44\]
```

### Служебные комментарии

В ходе текстологической работы могут понадобиться временные комментарии. Например, рядом с фрагментами требующими дополнительной работы. Для этого применяется специальная конструкция `comment`.

```
[comment текст комментария]
```

Пример

```
ŭĵ [comment не знаю, что это за символы]
```

Конструкция `comment`, обычно, должна вырезаться средствами отображения книг на этапе конвертации.

## Что нельзя использовать

### Неописанные элементы разметки

Не нужно использовать элементы разметки, не описанные выше. Их может не поддерживать VuePress или Pandoc.

## Рекомендации

### Выделения

Если несколько слов нужно выделить полужирным шрифтом, то используйте выделение для всего блока текста, не для каждого слова отдельно.

Правильно:

```md
**Равенство капиталов** означает **неравенство труда**.
```

Неправильно: 

```md
**Равенство** **капиталов** означает **неравенство** **труда**.
```

### Пробелы

За исключением элементов разметки, таких, как таблицы или примечания, не используете несколько пробелов подряд. Не допускается заканчивать абзац на пробел или несколько пробелов.

### Переводы строк

Отделяйте абзацы, заголовки и другие элементы разметки пустыми строками. Обратите внимание на пустые строки после заголовка и между абзацами:

```md
### О количестве и качестве товаров

Количество всех товаров узнается по весу или по мере. Причина тяжести вещей непонятна, и определение её не является целью нашей работы. Неизвестно, происходит ли она от эластичности воздуха, или от веса высшей сферы (атмосферы? — *И. П.*), или от других причин, — достаточно того, что способы определения веса тел в совершенстве открыты с помощью весов. В общем употреблении имеются два сорта весовых мер: тройский вес и торговый вес (Averdupois).

Первый применяется для взвешивания особенно ценных товаров, как золото, серебро и шёлк и т. д. Второй — для взвешивания более грубых и более объёмистых товаров, как свинец, железо и проч.
```

Не оставляйте в тексте больше одной пустой строки подряд.