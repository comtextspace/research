# Структура словарей Hunspell

Простейшей способ проверки орфографии — составить словарь правильным слов и проверять каждое слово на вхождение в этот словарь. Этот способ неудобен и не универсален так как слов много. Например, слова могут иметь разные формы такие как `дом` и `дома`. Другой пример: слово `дом` будет правильное даже если написано с большой буквы `Дом`, например, если оно стоит в начале предложение, а вот имя `Василий` должно быть написано с большой буквы в любом случае. Эти и другие особые ситуации затрудняют использование словаря в виде простого списка.

Библиотека [Hunspell](https://hunspell.github.io) ([Википедия — Hunspell](https://ru.wikipedia.org/wiki/Hunspell)) позволяет производить проверку орфографии с учетом морфологии слов, а так же предоставляет другие возможности.

Словари Hunspell состоят из двух файлов файл со словами (`.dic`) и файл с правилами (файл аффиксов `.aff`). Существует [документация по формату словарей](https://mozilla-russia.org/projects/dictionary/hunspell.html). Далее приводятся примеры работы некоторых команды из этой документации и приводятся ссылки на реальные словари использующие указанные команды, чаще всего из [репозитория LibreOffice](https://github.com/LibreOffice/dictionaries).

Для генерации примеров используется библиотека Python [pyhunspell](https://github.com/pyhunspell/pyhunspell) и следующий код:

TODO код

В каждом примере приведено содержимой файлов `aff` и `dic`, а так же несколько слов для проверки работы. В некоторых местах указаны цитаты из документации. Рассмотрены только команды влияющие на проверку слов, а не на другие функции Hunspell.

[[TOC]]

## Минимальный словарь

Файл `.aff` обязательно должен содержать указание кодировки, лучше использовать `UTF-8`. Если других правил в `.aff` файле не будет, то слова из словаря будут проверятся на точное совпадение.

```
.aff --------------------------------------------------
SET UTF-8
.dic --------------------------------------------------
1
сюртук
-------------------------------------------------------
Проверка слов:
сюртук — ✅
сюртуки — ❌
холст — ❌
```

> **SET** кодировка
> 
> Устанавливает кодировку символов для слов и морфем в файлах словаря и аффиксов. Поддерживаемые значения: UTF-8, ISO8859−1 − ISO8859−10, ISO8859−13 − ISO8859−15, KOI8-R, KOI8-U, microsoft-cp1251, ISCII-DEVANAGARI.

В большинстве словарей используется кодировка UTF-8, примеры словарей с другой кодировкой: [`de_DE_frami`](https://github.com/LibreOffice/dictionaries/tree/master/de) и [`pl_PL.dic`](https://github.com/LibreOffice/dictionaries/tree/master/pl_PL).

## Учёт регистра символов

Если слово в словаре указано в нижнем регистре, то при проверке оно будет правильным даже если поступит на проверку с первой буквой в верхнем регистре. Если же слово в словаре начинается с большой буквы, то при проверке оно будет правильным только если так же указано с большой буквы. Любое слово из словаря со всеми буквами в верхнем регистре будет правильным.

Эта особенность используется для проверки правильности имён собственных.

```
.aff --------------------------------------------------
SET UTF-8
.dic --------------------------------------------------
2
сюртук
Василий
-------------------------------------------------------
Проверка слов:
сюртук — ✅
Сюртук — ✅
СЮРТУК — ✅
сЮртук — ❌
Василий — ✅
ВАСИЛИЙ — ✅
василий — ❌
вАсилий — ❌
```

## KEEPCASE

Для того чтобы пометить определенное слово в `.aff` файле определяются специальные флаги, а в `.dic` этими флагами помечается слово. Список флагов добавляется в конце слова через символ `/`.

В следующем примере через директиву `KEEPCASE` объявлен флаг `K` а затем этот флаг добавлен к двум словам в `.dic` файле.

```
.aff --------------------------------------------------
SET UTF-8
KEEPCASE K
.dic --------------------------------------------------
2
сюртук/K
iPhone/K
-------------------------------------------------------
Проверка слов:
сюртук — ✅
Сюртук — ❌
СЮРТУК — ❌
iPhone — ✅
IPHONE — ❌
iphone — ❌
iPhOne — ❌
```

> **KEEPCASE** флаг
>
> Для слов, отмеченных флагом KEEPCASE, запрещается образование форм в верхнем регистре и форм, начинающихся с прописной буквы. Полезно для специальных орфографий (в которых единицы измерений и символы валют не изменяют регистр даже в текстах, состоящих из прописных букв) и систем написания (например, для сохранения нижнего регистра символов IPA).

Команда используется в словарях [`de_DE_frami`](https://github.com/LibreOffice/dictionaries/tree/master/de) и [`fr`](https://github.com/LibreOffice/dictionaries/tree/master/fr_FR).

## Небуквенные символы

В словах могут присутствовать небуквенные символы: апостроф (`’`), дефис (`-`), цифры и другие. С помощью них в словарь можно добавлять сложные слова и сокращения.

```
.aff --------------------------------------------------
SET UTF-8

.dic --------------------------------------------------
5
абстрактно-общее
Д’Аржансон
Д.
м.
Agent007
-------------------------------------------------------
Проверка слов:
абстрактно-общее — ✅
Д’Аржансон — ✅
Д'Аржансон — ❌
Д. — ✅
Д — ❌
М. — ✅
Agent007 — ✅
```

Слова в словаре могут содержать символ `/`, для этого его нужно экранировать, так как он является разделителем между словом и флагами.

```
.aff --------------------------------------------------
SET UTF-8

.dic --------------------------------------------------
1
и\/или
-------------------------------------------------------
Проверка слов:
и/или — ✅
```

> Файл словаря (.dic) содержит список слов, по одному слову в строке. В первой строке словарей (за исключением персональных словарей) указывается приблизительное количество слов в словаре (для оптимального распределения памяти). После каждого слова может следовать слэш ("/") и один или более флагов, соответствующих аффиксам и атрибутам. Слова в словаре также могут содержать слэши, экранированные "\\/". По умолчанию, флаг представляет собой один (обычно, алфавитный) символ. В файле словаря Hunspell также может существовать поле для морфологического описания, отделяемое табуляцией.

## BREAK

Hunspell умеет проверять сложные слова составленные из простых. В русском языке возможно два варианта соединения таких слов: через дефис `-` и через косую черту `/`. Проверим эту функцию.

```
.aff --------------------------------------------------
SET UTF-8
.dic --------------------------------------------------
5
и
или
либо
абстрактно
общее
-------------------------------------------------------
Проверка слов:
и/или — ❌
либо/либо — ❌
абстрактно-общее — ✅
конкретно-общее — ❌
```

Дефис работает, а косая черта нет. Задать список символов разделителей можно через команду `BREAK`.

> **BREAK** количество_определений_разделений
> **BREAK** символ_или_последовательность_символов
>
> Определяет точку для разделения слова и проверку полученных частей по отдельности. Полезно для сложносоставных слов, объединенных с помощью одного символа или последовательности символов (например, дефис в английском и немецком или дефис и короткое тире в венгерском языках). Тире не рекомендуется использовать как точку для разбиения слов, т.к. сложносоставные слова с тире могут содержать неправильные части. Используя BREAK, Hunspell может проверить обе части сложносоставных слов, разделяя слова по обычным и коротким тире:

```
.aff --------------------------------------------------
SET UTF-8

BREAK 2
BREAK /
BREAK -
.dic --------------------------------------------------
5
и
или
либо
абстрактно
общее
-------------------------------------------------------
Проверка слов:
и/или — ✅
либо/либо — ✅
абстрактно-общее — ✅
конкретно-общее — ❌
```

Команда используется в словарях [`de_DE_frami`](https://github.com/LibreOffice/dictionaries/tree/master/de), [`fr`](https://github.com/LibreOffice/dictionaries/tree/master/fr_FR), [`grc_GR`](https://github.com/mrakia/hunspell-ancient-greek).

## IGNORE

Иногда полезно исключить из проверки некоторые символы. Рассмотрим пример, в словаре есть несколько слов и некоторые из них указаны с ударением.

```
.aff --------------------------------------------------
SET UTF-8

.dic --------------------------------------------------
3
большим
что́
что
-------------------------------------------------------
Проверка слов:
большим — ✅
бо́льшим — ❌
что́ — ✅
что — ✅
```

Слова с ударением проверены правильно. Слово `бо́льшим` определилось как неверное, так как в словаре нет этого слова с ударением. Удобно игнорировать символ ударения при проверке чтобы не было необходимости дублировать в слова словаре.

```
.aff --------------------------------------------------
SET UTF-8

IGNORE ́
.dic --------------------------------------------------
2
большим
что
-------------------------------------------------------
Проверка слов:
большим — ✅
бо́льшим — ✅
что́ — ✅
что — ✅
```

Символ ударения игнорируется при проверке (удаляется) и правильными определяются как слова с ударением так и слова без ударения.

Команда используется в словаре [`uk_UA`](https://github.com/LibreOffice/dictionaries/tree/master/uk_UA).

## ICONV

Команда `ICONV` определяет замены во входных данных перед проверкой по словарю. Например, иногда в тексте вместо правильного апострофа `’` установлен символ `’`. В этом случае словарь определит солово как неверное.

```
.aff --------------------------------------------------
SET UTF-8
.dic --------------------------------------------------
1
Д’Аржансон
-------------------------------------------------------
Проверка слов:
Д'Аржансон — ❌
```

При замене через `ICONV` символа `'` на `’` слово уже будет определено верно.

```
.aff --------------------------------------------------
SET UTF-8

ICONV 1
ICONV ' ’
.dic --------------------------------------------------
1
Д’Аржансон
-------------------------------------------------------
Проверка слов:
Д'Аржансон — ✅
```

Однако, для приведенного случая, кажется неверным заменять символ апострофа, чтобы найти ошибочное использование символа.

Команда используется в словаре [`uk_UA`](https://github.com/LibreOffice/dictionaries/tree/master/uk_UA), причем применение этой команды особое, в качестве символа замены указан `0`, что означает удаление символа. Из-за этого словарь игнорирует часть букв и ошибочно определяет часть слов как правильные. Эта особенность может влиять на системы которые используют для проверки несколько словарей разных языков.

```
.aff --------------------------------------------------
SET UTF-8

ICONV 6
ICONV a 0
ICONV b 0
ICONV c 0
ICONV d 0
ICONV e 0
ICONV f 0
.dic --------------------------------------------------
1
холст
-------------------------------------------------------
Проверка слов:
bbbхолст — ❌
aba — ✅
abaz — ❌
```

## COMPOUNDFLAG

```
.aff --------------------------------------------------
SET UTF-8

COMPOUNDFLAG C
.dic --------------------------------------------------
3
само/C	
кат/C
лёт
-------------------------------------------------------
Проверка слов:
само — ✅
лёт — ✅
кат — ✅
самокат — ✅
самолёт — ❌
катсамо — ✅
```